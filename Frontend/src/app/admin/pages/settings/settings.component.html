<div class="page-wrapper">
  <header class="page-header">
    <div>
      <h1 class="page-title">System Settings</h1>
      <p class="page-subtitle">Configure application settings and preferences</p>
    </div>
    <div class="header-actions">
      <button class="btn-secondary" (click)="resetToDefaults()" [disabled]="saving()">
        Reset to Defaults
      </button>
      <button class="btn-primary" (click)="saveSettings()" [disabled]="saving()">
        {{ saving() ? 'Saving...' : 'Save Changes' }}
      </button>
    </div>
  </header>

  @if (loading()) {
  <section class="loading-state">
    <div class="spinner"></div>
    <p>Loading settings...</p>
  </section>
  }

  @if (!loading()) {
  <div class="settings-grid">
    <!-- GENERAL SETTINGS -->
    <section class="settings-panel">
      <div class="panel-header">
        <h3 class="panel-title">üè¢ General Settings</h3>
      </div>
      <div class="panel-body">
        <div class="form-group">
          <label>Site Name</label>
          <input type="text" [ngModel]="getSetting('siteName')" (ngModelChange)="updateSetting('siteName', $event)" placeholder="RevTicket">
        </div>

        <div class="form-group">
          <label>Support Email</label>
          <input type="email" [ngModel]="getSetting('siteEmail')" (ngModelChange)="updateSetting('siteEmail', $event)" placeholder="support@revticket.com">
        </div>

        <div class="form-group">
          <label>Support Phone</label>
          <input type="tel" [ngModel]="getSetting('sitePhone')" (ngModelChange)="updateSetting('sitePhone', $event)" placeholder="+91 1234567890">
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Currency</label>
            <select [ngModel]="getSetting('currency')" (ngModelChange)="updateSetting('currency', $event)">
              <option value="INR">INR (‚Çπ)</option>
              <option value="USD">USD ($)</option>
              <option value="EUR">EUR (‚Ç¨)</option>
              <option value="GBP">GBP (¬£)</option>
            </select>
          </div>

          <div class="form-group">
            <label>Timezone</label>
            <select [ngModel]="getSetting('timezone')" (ngModelChange)="updateSetting('timezone', $event)">
              <option value="Asia/Kolkata">Asia/Kolkata (IST)</option>
              <option value="America/New_York">America/New_York (EST)</option>
              <option value="Europe/London">Europe/London (GMT)</option>
              <option value="Asia/Dubai">Asia/Dubai (GST)</option>
            </select>
          </div>
        </div>
      </div>
    </section>

    <!-- BOOKING SETTINGS -->
    <section class="settings-panel">
      <div class="panel-header">
        <h3 class="panel-title">üé´ Booking Settings</h3>
      </div>
      <div class="panel-body">
        <div class="form-group">
          <label>Cancellation Window (Hours)</label>
          <input type="number" [ngModel]="getSetting('bookingCancellationHours')" (ngModelChange)="updateSetting('bookingCancellationHours', +$event)" min="0" max="48">
          <small>Users can cancel bookings up to this many hours before showtime</small>
        </div>

        <div class="form-group">
          <label>Max Seats Per Booking</label>
          <input type="number" [ngModel]="getSetting('maxSeatsPerBooking')" (ngModelChange)="updateSetting('maxSeatsPerBooking', +$event)" min="1" max="20">
          <small>Maximum number of seats a user can book in one transaction</small>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Convenience Fee (%)</label>
            <input type="number" [ngModel]="getSetting('convenienceFeePercent')" (ngModelChange)="updateSetting('convenienceFeePercent', +$event)" min="0" max="20" step="0.1">
          </div>

          <div class="form-group">
            <label>GST (%)</label>
            <input type="number" [ngModel]="getSetting('gstPercent')" (ngModelChange)="updateSetting('gstPercent', +$event)" min="0" max="30" step="0.1">
          </div>
        </div>

        <div class="info-box">
          <strong>Example Calculation:</strong>
          <div class="calc-row">
            <span>Base Price:</span>
            <span>‚Çπ200</span>
          </div>
          <div class="calc-row">
            <span>Convenience Fee ({{ settings().convenienceFeePercent }}%):</span>
            <span>‚Çπ{{ (200 * settings().convenienceFeePercent / 100).toFixed(2) }}</span>
          </div>
          <div class="calc-row">
            <span>GST ({{ settings().gstPercent }}%):</span>
            <span>‚Çπ{{ ((200 + 200 * settings().convenienceFeePercent / 100) * settings().gstPercent / 100).toFixed(2) }}</span>
          </div>
          <div class="calc-row total">
            <span>Total:</span>
            <span>‚Çπ{{ (200 + 200 * settings().convenienceFeePercent / 100 + (200 + 200 * settings().convenienceFeePercent / 100) * settings().gstPercent / 100).toFixed(2) }}</span>
          </div>
        </div>
      </div>
    </section>

    <!-- NOTIFICATION SETTINGS -->
    <section class="settings-panel">
      <div class="panel-header">
        <h3 class="panel-title">üîî Notification Settings</h3>
      </div>
      <div class="panel-body">
        <div class="toggle-group">
          <div class="toggle-item">
            <div class="toggle-info">
              <strong>Enable Notifications</strong>
              <small>Master switch for all notifications</small>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" [ngModel]="getSetting('enableNotifications')" (ngModelChange)="updateSetting('enableNotifications', $event)">
              <span class="toggle-slider"></span>
            </label>
          </div>

          <div class="toggle-item" [class.disabled]="!getSetting('enableNotifications')">
            <div class="toggle-info">
              <strong>Email Notifications</strong>
              <small>Send booking confirmations and updates via email</small>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" [ngModel]="getSetting('enableEmailNotifications')" (ngModelChange)="updateSetting('enableEmailNotifications', $event)" [disabled]="!getSetting('enableNotifications')">
              <span class="toggle-slider"></span>
            </label>
          </div>

          <div class="toggle-item" [class.disabled]="!getSetting('enableNotifications')">
            <div class="toggle-info">
              <strong>SMS Notifications</strong>
              <small>Send booking confirmations and updates via SMS</small>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" [ngModel]="getSetting('enableSMSNotifications')" (ngModelChange)="updateSetting('enableSMSNotifications', $event)" [disabled]="!getSetting('enableNotifications')">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
      </div>
    </section>

    <!-- SYSTEM SETTINGS -->
    <section class="settings-panel">
      <div class="panel-header">
        <h3 class="panel-title">‚öôÔ∏è System Settings</h3>
      </div>
      <div class="panel-body">
        <div class="toggle-group">
          <div class="toggle-item maintenance">
            <div class="toggle-info">
              <strong>Maintenance Mode</strong>
              <small>Temporarily disable the site for maintenance</small>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" [ngModel]="getSetting('maintenanceMode')" (ngModelChange)="updateSetting('maintenanceMode', $event)">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        @if (settings().maintenanceMode) {
        <div class="warning-box">
          <strong>‚ö†Ô∏è Warning:</strong> Maintenance mode is enabled. Users will not be able to access the site.
        </div>
        }
      </div>
    </section>
  </div>
  }
</div>
