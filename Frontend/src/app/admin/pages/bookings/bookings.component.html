<div class="page-wrapper">
  <!-- HEADER -->
  <header class="page-header">
    <div class="header-content">
      <h1 class="page-title">Manage Bookings</h1>
      <p class="page-subtitle">View and manage all movie bookings</p>
    </div>
    <div class="header-stats">
      <div class="stat-card">
        <span class="stat-value">{{ bookings().length }}</span>
        <span class="stat-label">Total</span>
      </div>
      <div class="stat-card confirmed">
        <span class="stat-value">{{ getStatusCount('CONFIRMED') }}</span>
        <span class="stat-label">Confirmed</span>
      </div>
      <div class="stat-card pending">
        <span class="stat-value">{{ getStatusCount('CANCELLATION_PENDING') }}</span>
        <span class="stat-label">Pending</span>
      </div>
    </div>
  </header>

  <!-- FILTERS -->
  <section class="filters-bar">
    <div class="search-box">
      <span class="search-icon">üîç</span>
      <input type="text" 
             class="search-input" 
             placeholder="Search by booking ID, movie, customer name, email, or phone..." 
             [value]="searchTerm()"
             (input)="searchBookings($any($event.target).value)">
    </div>

    <div class="filter-tabs">
      <button class="filter-tab" 
              [class.active]="filterStatus() === 'ALL'"
              (click)="filterByStatus('ALL')">
        <span class="tab-text">All</span>
        <span class="tab-count">{{ getStatusCount('ALL') }}</span>
      </button>
      <button class="filter-tab" 
              [class.active]="filterStatus() === 'CONFIRMED'"
              (click)="filterByStatus('CONFIRMED')">
        <span class="tab-text">Confirmed</span>
        <span class="tab-count">{{ getStatusCount('CONFIRMED') }}</span>
      </button>
      <button class="filter-tab" 
              [class.active]="filterStatus() === 'CANCELLATION_PENDING'"
              (click)="filterByStatus('CANCELLATION_PENDING')">
        <span class="tab-text">Pending</span>
        <span class="tab-count">{{ getStatusCount('CANCELLATION_PENDING') }}</span>
      </button>
      <button class="filter-tab" 
              [class.active]="filterStatus() === 'CANCELLED'"
              (click)="filterByStatus('CANCELLED')">
        <span class="tab-text">Cancelled</span>
        <span class="tab-count">{{ getStatusCount('CANCELLED') }}</span>
      </button>
    </div>
  </section>

  <!-- LOADING -->
  @if (loading()) {
  <section class="loading-state">
    <div class="spinner"></div>
    <p>Loading bookings...</p>
  </section>
  }

  <!-- BOOKINGS GRID -->
  @if (!loading() && filteredBookings().length > 0) {
  <section class="bookings-grid">
    @for (booking of filteredBookings(); track booking.id) {
    <div class="booking-card">
      <div class="card-header">
        <span class="booking-id">{{ booking.ticketNumber || booking.id }}</span>
        <span class="status-pill" 
              [class.confirmed]="booking.status === 'CONFIRMED'"
              [class.cancelled]="booking.status === 'CANCELLED'"
              [class.pending]="booking.status === 'PENDING'"
              [class.cancellation_pending]="booking.status === 'CANCELLATION_PENDING'">
          {{ booking.status.replace('_', ' ') }}
        </span>
      </div>

      <div class="card-content">
        <div class="poster-section">
          <img [src]="booking.moviePosterUrl || 'assets/placeholder-movie.jpg'" 
               [alt]="booking.movieTitle" 
               class="movie-poster">
        </div>

        <div class="details-section">
          <div class="card-details">
            <div class="detail-row">
              <span class="detail-label">üé¨ Movie</span>
              <span class="detail-value">{{ booking.movieTitle }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">üè¢ Theatre</span>
              <span class="detail-value">{{ booking.theaterName }}{{ booking.theaterLocation ? ' - ' + booking.theaterLocation : '' }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">üì∫ Screen</span>
              <span class="detail-value">{{ booking.screen || 'N/A' }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">üìÖ Show Time</span>
              <span class="detail-value">{{ formatShowtime(booking.showtime) }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">üí∫ Seats</span>
              <span class="detail-value seats-container">
                @if (booking.seatLabels && booking.seatLabels.length > 0) {
                  @for (seat of booking.seatLabels; track seat) {
                    <span class="seat-badge">{{ seat }}</span>
                  }
                } @else if (booking.seats && booking.seats.length > 0) {
                  @for (seat of booking.seats; track seat) {
                    <span class="seat-badge">{{ seat }}</span>
                  }
                } @else {
                  <span>N/A</span>
                }
              </span>
            </div>
            <div class="detail-row">
              <span class="detail-label">üí∞ Amount</span>
              <span class="detail-value amount">{{ formatCurrency(booking.totalAmount || 0) }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">üìÜ Booked</span>
              <span class="detail-value">{{ formatDate(booking.bookingDate) }}</span>
            </div>
          </div>

          <div class="user-info">
            <div class="user-info-title">üë§ Customer Details</div>
            <div class="user-info-row">
              <span class="user-label">Name:</span>
              <span class="user-value">{{ booking.customerName }}</span>
            </div>
            <div class="user-info-row">
              <span class="user-label">Email:</span>
              <span class="user-value">{{ booking.customerEmail }}</span>
            </div>
            <div class="user-info-row">
              <span class="user-label">Phone:</span>
              <span class="user-value">{{ booking.customerPhone }}</span>
            </div>
          </div>
        </div>
      </div>

      <div class="card-actions">
        @if (booking.status === 'CONFIRMED') {
          <button class="action-btn btn-danger" 
                  (click)="cancelBooking(booking)"
                  [disabled]="!canCancelBooking(booking)"
                  [title]="canCancelBooking(booking) ? 'Cancel this booking' : 'Cannot cancel - show has passed'">
            <span class="btn-icon">‚ùå</span>
            <span class="btn-text">{{ canCancelBooking(booking) ? 'Cancel Booking' : 'Show Completed' }}</span>
          </button>
        }
        @if (booking.status === 'CANCELLATION_PENDING') {
          <div class="pending-alert">
            <span class="alert-icon">‚è≥</span>
            <div class="alert-content">
              <span class="alert-text">Customer requested cancellation</span>
              @if (booking.cancellationReason) {
                <span class="alert-reason">Reason: {{ booking.cancellationReason }}</span>
              }
            </div>
          </div>
          <button class="action-btn btn-success" (click)="approveCancellation(booking)">
            <span class="btn-icon">‚úÖ</span>
            <span class="btn-text">Approve Cancellation</span>
          </button>
        }
        @if (booking.status === 'CANCELLED') {
          <div class="cancelled-info">
            <span class="info-icon">‚ÑπÔ∏è</span>
            <span class="info-text">Booking cancelled - Seats freed</span>
          </div>
        }
      </div>
    </div>
    }
  </section>
  }

  <!-- EMPTY STATE -->
  @if (!loading() && filteredBookings().length === 0) {
  <section class="empty-state">
    <div class="empty-icon">üé´</div>
    <h3>No Bookings Found</h3>
    <p>{{ searchTerm() || filterStatus() !== 'ALL' ? 'Try adjusting your filters' : 'No bookings have been made yet' }}</p>
  </section>
  }
</div>
