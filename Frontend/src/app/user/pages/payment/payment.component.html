<div class="payment-container" *ngIf="bookingDraft() && costBreakdown(); else missingBooking">
  <div class="payment-header">
    <button class="back-button" (click)="goBack()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
      Back to Seats
    </button>
    <h1>Complete Your Booking</h1>
  </div>
  
  <div class="payment-grid">
    <section class="payment-card">
      <h2>Payment Details</h2>

      <form [formGroup]="contactForm" class="contact-form">
        <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem; color: #333;">Contact Information</h3>
        <div class="form-row">
          <label>Full Name *</label>
          <input type="text" formControlName="name" placeholder="Enter your full name">
        </div>
        <div class="form-row">
          <label>Email Address *</label>
          <input type="email" formControlName="email" placeholder="your@email.com">
        </div>
        <div class="form-row">
          <label>Mobile Number *</label>
          <input type="tel" formControlName="phone" placeholder="10-digit mobile number">
        </div>
      </form>

      <div class="payment-info">
        <h3>üí≥ Payment via Razorpay</h3>
        <p>Secure payment gateway supporting UPI, Cards, Wallets & Net Banking</p>
      </div>

      <div class="payment-actions">
        <button 
          type="button" 
          class="pay-button" 
          (click)="processPayment()" 
          [disabled]="processing()">
          <span *ngIf="!processing()">Pay {{ settingsService.currencySymbol() }}{{ costBreakdown()!.total }}</span>
          <span *ngIf="processing()">‚è≥ Processing Payment...</span>
        </button>
        <p class="secure-note">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
            <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
          </svg>
          Your payment is 100% secure and encrypted
        </p>
      </div>
    </section>

    <section class="summary-card">
      <h2>Booking Summary</h2>
      <div class="movie-info">
        <h3>üé¨ {{ bookingDraft()!.movieTitle }}</h3>
        <p><strong>{{ bookingDraft()!.theaterName }}</strong></p>
        <p>{{ bookingDraft()!.theaterLocation }}</p>
        <p>üìÖ {{ bookingDraft()!.showDateTime | date:'EEE, MMM d, y' }}</p>
        <p>üïê {{ bookingDraft()!.showDateTime | date:'h:mm a' }}</p>
      </div>

      <div class="seat-info">
        <div class="label">Selected Seats</div>
        <div class="value">{{ bookingDraft()!.seatLabels?.join(', ') || bookingDraft()!.seats.join(', ') }}</div>
      </div>

      <div class="cost-breakdown">
        <div class="row">
          <span>Tickets ({{ bookingDraft()!.seats.length }})</span>
          <span>{{ settingsService.currencySymbol() }}{{ costBreakdown()!.baseAmount }}</span>
        </div>
        <div class="row">
          <span>Convenience Fee ({{ settingsService.convenienceFee() }}%)</span>
          <span>{{ settingsService.currencySymbol() }}{{ costBreakdown()!.convenienceFee }}</span>
        </div>
        <div class="row">
          <span>GST ({{ settingsService.gst() }}%)</span>
          <span>{{ settingsService.currencySymbol() }}{{ costBreakdown()!.gst }}</span>
        </div>
        <div class="row total">
          <span>Amount Payable</span>
          <span>{{ settingsService.currencySymbol() }}{{ costBreakdown()!.total }}</span>
        </div>
      </div>
    </section>
  </div>
</div>

<ng-template #missingBooking>
  <div class="payment-container missing-booking">
    <div class="missing-content">
      <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/>
        <line x1="12" y1="8" x2="12" y2="12"/>
        <line x1="12" y1="16" x2="12.01" y2="16"/>
      </svg>
      <h2>‚ö†Ô∏è Session Expired</h2>
      <p>Your booking session has expired or is invalid. Please select your seats again to continue.</p>
      <button class="pay-button" routerLink="/user/home">üè† Return to Home</button>
    </div>
  </div>
</ng-template>