<div class="profile-container">
  <div class="loading-overlay" *ngIf="loadingProfile()">
    <div class="spinner"></div>
    <p>Loading profile...</p>
  </div>

  <div *ngIf="!loadingProfile() && user()" class="profile-wrapper">
    <div class="profile-header">
      <div class="header-background"></div>
      <div class="header-content">
        <div class="profile-avatar">
          <div class="avatar-ring"></div>
          <img 
            src="assets/images/users/default-avatar.svg" 
            [alt]="displayName"
            (error)="onImageError($event)">
          <button class="avatar-edit" (click)="changeAvatar()">
            <span class="icon">ğŸ“·</span>
          </button>
        </div>
        <div class="profile-info">
          <h1>{{ displayName }}</h1>
          <p class="email">âœ‰ï¸ {{ displayEmail }}</p>
          <div class="profile-badges">
            <span class="badge member-badge">
              <span class="badge-icon">â­</span>
              Member since {{ memberSince | date:'MMM yyyy' }}
            </span>
            <span class="badge role-badge">{{ user()?.role || 'USER' }}</span>
          </div>
        </div>
      </div>
    </div>

    <div class="profile-content">
      <div class="profile-tabs">
        <button 
          class="tab-btn" 
          [class.active]="activeTab() === 'personal'"
          (click)="setActiveTab('personal')">
          <span class="tab-icon">ğŸ‘¤</span>
          <span class="tab-label">Personal Info</span>
        </button>
        <button 
          class="tab-btn" 
          [class.active]="activeTab() === 'preferences'"
          (click)="setActiveTab('preferences')">
          <span class="tab-icon">âš™ï¸</span>
          <span class="tab-label">Preferences</span>
        </button>
        <button 
          class="tab-btn" 
          [class.active]="activeTab() === 'security'"
          (click)="setActiveTab('security')">
          <span class="tab-icon">ğŸ”’</span>
          <span class="tab-label">Security</span>
        </button>
      </div>

      <div class="tab-content">
        <!-- Personal Info Tab -->
        <div class="tab-panel" *ngIf="activeTab() === 'personal'">
          <div class="section-card">
            <div class="section-header">
              <h3>ğŸ‘¤ Personal Information</h3>
              <p class="section-subtitle">Manage your personal details and contact information</p>
            </div>
            <form [formGroup]="profileForm" (ngSubmit)="updateProfile()">
              <div class="form-row">
                <div class="form-group">
                  <label for="name">Full Name *</label>
                  <input 
                    type="text" 
                    id="name" 
                    formControlName="name"
                    placeholder="Enter your full name">
                  <span class="error" *ngIf="profileForm.get('name')?.invalid && profileForm.get('name')?.touched">
                    Name is required (min 2 characters)
                  </span>
                </div>
                <div class="form-group">
                  <label for="phone">Phone Number</label>
                  <input 
                    type="tel" 
                    id="phone" 
                    formControlName="phone"
                    placeholder="10-digit phone number">
                  <span class="error" *ngIf="profileForm.get('phone')?.invalid && profileForm.get('phone')?.touched">
                    Phone must be 10 digits
                  </span>
                </div>
              </div>
              
              <div class="form-row">
                <div class="form-group">
                  <label for="dateOfBirth">Date of Birth</label>
                  <input 
                    type="date" 
                    id="dateOfBirth" 
                    formControlName="dateOfBirth">
                </div>
                <div class="form-group">
                  <label for="gender">Gender</label>
                  <select id="gender" formControlName="gender">
                    <option value="">Select Gender</option>
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                    <option value="other">Other</option>
                  </select>
                </div>
              </div>

              <div class="form-group">
                <label for="address">Address</label>
                <textarea 
                  id="address" 
                  formControlName="address"
                  placeholder="Enter your address"
                  rows="3"></textarea>
              </div>

              <div class="form-group">
                <label>Email</label>
                <input 
                  type="email" 
                  [value]="displayEmail"
                  disabled
                  style="background: #e9ecef; cursor: not-allowed;">
                <small style="color: #666; font-size: 0.85rem;">Email cannot be changed</small>
              </div>

              <div class="form-actions">
                <button type="submit" class="btn-primary" [disabled]="profileForm.invalid || loading()">
                  <span *ngIf="!loading()">ğŸ’¾ Save Changes</span>
                  <span *ngIf="loading()" class="loading-spinner">â³ Updating...</span>
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- Preferences Tab -->
        <div class="tab-panel" *ngIf="activeTab() === 'preferences'">
          <div class="section-card">
            <div class="section-header">
              <h3>ğŸ¬ Movie Preferences</h3>
              <p class="section-subtitle">Customize your movie experience and notifications</p>
            </div>
            <div class="preferences-grid">
              <div class="preference-item">
                <label>Preferred Language</label>
                <select [ngModel]="preferences().language" (ngModelChange)="updateLanguage($event)">
                  <option value="english">English</option>
                  <option value="hindi">Hindi</option>
                  <option value="tamil">Tamil</option>
                  <option value="telugu">Telugu</option>
                  <option value="malayalam">Malayalam</option>
                  <option value="kannada">Kannada</option>
                </select>
              </div>
              
              <div class="preference-item">
                <label>Notifications</label>
                <div class="notification-settings">
                  <div class="setting-item">
                    <input 
                      type="checkbox" 
                      id="emailNotifications" 
                      [ngModel]="preferences().emailNotifications"
                      (ngModelChange)="updateEmailNotifications($event)">
                    <label for="emailNotifications">Email Notifications</label>
                  </div>
                  <div class="setting-item">
                    <input 
                      type="checkbox" 
                      id="smsNotifications" 
                      [ngModel]="preferences().smsNotifications"
                      (ngModelChange)="updateSmsNotifications($event)">
                    <label for="smsNotifications">SMS Notifications</label>
                  </div>
                  <div class="setting-item">
                    <input 
                      type="checkbox" 
                      id="pushNotifications" 
                      [ngModel]="preferences().pushNotifications"
                      (ngModelChange)="updatePushNotifications($event)">
                    <label for="pushNotifications">Push Notifications</label>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="form-actions">
              <button class="btn-primary" (click)="updatePreferences()" [disabled]="loading()">
                <span *ngIf="!loading()">ğŸ’¾ Save Preferences</span>
                <span *ngIf="loading()" class="loading-spinner">â³ Saving...</span>
              </button>
            </div>
          </div>
        </div>

        <!-- Security Tab -->
        <div class="tab-panel" *ngIf="activeTab() === 'security'">
          <div class="section-card password-card">
            <div class="password-header">
              <div class="password-icon">ğŸ”</div>
              <div>
                <h3>Change Password</h3>
                <p class="password-subtitle">Keep your account secure with a strong password</p>
              </div>
            </div>
            
            <form [formGroup]="passwordForm" (ngSubmit)="changePassword()">
              <div class="password-form-grid">
                <div class="form-group password-input-group">
                  <label for="currentPassword">
                    <span class="label-icon">ğŸ”‘</span>
                    Current Password
                  </label>
                  <div class="input-wrapper">
                    <input 
                      [type]="showCurrentPassword() ? 'text' : 'password'"
                      id="currentPassword" 
                      formControlName="currentPassword"
                      placeholder="Enter your current password"
                      class="password-input">
                    <button 
                      type="button" 
                      class="toggle-password"
                      (click)="toggleCurrentPassword()">
                      {{ showCurrentPassword() ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸â€ğŸ—¨ï¸' }}
                    </button>
                  </div>
                  <span class="error" *ngIf="passwordForm.get('currentPassword')?.invalid && passwordForm.get('currentPassword')?.touched">
                    Current password is required
                  </span>
                </div>
                
                <div class="form-group password-input-group">
                  <label for="newPassword">
                    <span class="label-icon">âœ¨</span>
                    New Password
                  </label>
                  <div class="input-wrapper">
                    <input 
                      [type]="showNewPassword() ? 'text' : 'password'"
                      id="newPassword" 
                      formControlName="newPassword"
                      placeholder="Enter new password (min 6 characters)"
                      class="password-input">
                    <button 
                      type="button" 
                      class="toggle-password"
                      (click)="toggleNewPassword()">
                      {{ showNewPassword() ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸â€ğŸ—¨ï¸' }}
                    </button>
                  </div>
                  <div class="password-strength" *ngIf="passwordForm.get('newPassword')?.value">
                    <div class="strength-bar">
                      <div class="strength-fill" [class]="getPasswordStrength()"></div>
                    </div>
                    <span class="strength-text" [class]="getPasswordStrength()">
                      {{ getPasswordStrengthText() }}
                    </span>
                  </div>
                  <span class="error" *ngIf="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched">
                    Password must be at least 6 characters
                  </span>
                </div>
                
                <div class="form-group password-input-group">
                  <label for="confirmPassword">
                    <span class="label-icon">âœ“</span>
                    Confirm New Password
                  </label>
                  <div class="input-wrapper">
                    <input 
                      [type]="showConfirmPassword() ? 'text' : 'password'"
                      id="confirmPassword" 
                      formControlName="confirmPassword"
                      placeholder="Re-enter your new password"
                      class="password-input">
                    <button 
                      type="button" 
                      class="toggle-password"
                      (click)="toggleConfirmPassword()">
                      {{ showConfirmPassword() ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸â€ğŸ—¨ï¸' }}
                    </button>
                  </div>
                  <span class="error" *ngIf="passwordForm.get('confirmPassword')?.value && passwordForm.get('newPassword')?.value !== passwordForm.get('confirmPassword')?.value">
                    Passwords do not match
                  </span>
                </div>
              </div>

              <div class="password-tips">
                <h4>Password Requirements:</h4>
                <ul>
                  <li [class.met]="passwordForm.get('newPassword')?.value?.length >= 6">At least 6 characters long</li>
                  <li [class.met]="hasUpperCase()">Contains uppercase letter</li>
                  <li [class.met]="hasLowerCase()">Contains lowercase letter</li>
                  <li [class.met]="hasNumber()">Contains a number</li>
                </ul>
              </div>

              <div class="form-actions password-actions">
                <button type="button" class="btn-secondary" (click)="resetPasswordForm()">
                  Cancel
                </button>
                <button type="submit" class="btn-primary" [disabled]="passwordForm.invalid || loading() || !passwordsMatch()">
                  <span *ngIf="!loading()">ğŸ”’ Update Password</span>
                  <span *ngIf="loading()" class="loading-spinner">â³ Updating...</span>
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
